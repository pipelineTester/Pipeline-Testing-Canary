<project name="CanaryGitHub1" default="deploy">

  <property name='cf' value='cf' />

  <target name="check-manifest">
      <available file="manifest.yml" property="hasManifest"/>
  </target>

	<target name="deploy" depends="deploy-with-manifest, deploy-with-params">
  </target>

  <target name="deploy-with-manifest" depends="check-manifest" if="hasManifest">
    <exec dir='${basedir}' executable='${cf}' failonerror='true'>
      <arg line="api ${cf.apiEndpoint}"/>
    </exec>

  	<exec dir='${basedir}' executable='${cf}' failonerror='true'>
      <arg line="auth ${cf.user} ${cf.password}"/>
    </exec>

  	<exec dir='${basedir}' executable='${cf}' failonerror='true'>
      <arg line="target -o ${cf.org} -s ${cf.space}"/>
    </exec>

    <exec dir='${basedir}' executable='${cf}' failonerror='true'>
      <arg line="push"/>
    </exec>

    <exec dir='${basedir}' executable='${cf}' failonerror='true'>
      <arg line="logout"/>
    </exec>
  </target>

	<target name="deploy-with-params" depends="check-manifest" unless="hasManifest">
    <exec dir='${basedir}' executable='${cf}' failonerror='true'>
      <arg line="api ${cf.apiEndpoint}"/>
    </exec>

    <exec dir='${basedir}' executable='${cf}' failonerror='true'>
      <arg line="auth ${cf.user} ${cf.password}"/>
    </exec>

    <exec dir='${basedir}' executable='${cf}' failonerror='true'>
      <arg line="target -o ${cf.org} -s ${cf.space}"/>
    </exec>

    <exec dir='${basedir}' executable='${cf}' failonerror='true'>
      <arg line="push ${cf.app}"/>
    </exec>

    <exec dir='${basedir}' executable='${cf}' failonerror='true'>
      <arg line="logout"/>
    </exec>
  </target>
</project>